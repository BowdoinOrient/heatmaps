<html>
<head>
    <title>Heatmaps!</title>
</head>
<body>
    <!-- I won't need this jquery include on BO.COM, but i'll need it here -->
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>

    <!-- Everything from here down will be the HTMLattachment -->
    <style>
        .attachment-wrapper {width:890px; height:600px; display:block; position:relative;}
        .heatmap-anchor {width:70%; height:100%;position:absolute; left:0; z-index:99;}
        .controls {width:29%; height:99.5%; position:absolute; right:0; padding:0 10px; border: 1px dotted gray;}
        .cbx-label {display:inline-block; padding-left:10px;}
        .cbx-label.bold {font-weight:bold;}
        .controls label {padding-left:35px; cursor:hand;}
        .controls label:first-child {padding-left:10px;}
        label p {margin:2px 0; max-width:80%;}
        label input {cursor:hand;}
        button.map-btn {margin:15px 15px; width:70px; height:25px; cursor:hand;}
        button.map-btn.first {margin-left:35px;}
    </style>
    <div class="attachment-wrapper">
        <div class="heatmap-anchor"></div>
        <div class="controls">
            <div class="box-group">
                <label><input type="checkbox" id="substances" class="group"><p class="cbx-label bold">Substances</p></label></br>
                <label><input type="checkbox" id="marijuana"><p class="cbx-label">Marijuana</p></label></br>
                <label><input type="checkbox" id="minor-possession-of-alcohol"><p class="cbx-label">Minor in Posession Citation</p></label></br>
                <label><input type="checkbox" id="hard-alcohol-violation"><p class="cbx-label">Hard Alcohol Violation</p></label></br>
                <label><input type="checkbox" id="smoking-policy-violation"><p class="cbx-label">Smoking Policy Violation</p></label></br>
            </div>

            <div class="box-group">
                <label><input type="checkbox" id="intoxication" class="group"><p class="cbx-label bold">Intoxication</p></label></br>
                <label><input type="checkbox" id="alcohol-related-transport"><p class="cbx-label">Alcohol-Related Transport</p></label></br>
                <label><input type="checkbox" id="wellness-check"><p class="cbx-label">Wellness Check</p></label></br>
                <label><input type="checkbox" id="public-indecency"><p class="cbx-label">Public Indecency</p></label></br>
            </div>

            <div class="box-group">
                <label><input type="checkbox" id="parties" class="group"><p class="cbx-label bold">Parties</p></label></br>
                <label><input type="checkbox" id="noise-complaint"><p class="cbx-label">Noise Complaint</p></label></br>
                <label><input type="checkbox" id="unregistered-event"><p class="cbx-label">Unregistered Event</p></label></br>
            </div>

            <div class="box-group">
                <label><input type="checkbox" id="disruption" class="group"><p class="cbx-label bold">Disruption</p></label></br>
                <label><input type="checkbox" id="vandalism"><p class="cbx-label">Vandalism</p></label></br>
                <label><input type="checkbox" id="wall-damage"><p class="cbx-label">Wall Damage</p></label></br>
                <label><input type="checkbox" id="disruptive-individual"><p class="cbx-label">Disruptive Individual</p></label></br>
            </div>

            <div class="box-group">
                <label><input type="checkbox" id="theft" class="group"><p class="cbx-label bold">Theft</p></label></br>
                <label><input type="checkbox" id="bike-theft"><p class="cbx-label">Bike Theft</p></label></br>
                <label><input type="checkbox" id="theft"><p class="cbx-label">General Theft</p></label></br>
            </div>

            <div class="box-group">
                <label><input type="checkbox" id="other" class="group"><p class="cbx-label bold">Other</p></label></br>
                <label><input type="checkbox" id="fire-alarm"><p class="cbx-label">Fire Alarm</p></label></br>
                <label><input type="checkbox" id="trespassing"><p class="cbx-label">Trespassing</p></label></br>
                <label><input type="checkbox" id="car-related-incident"><p class="cbx-label">Car-Related Incident</p></label></br>
                <label><input type="checkbox" id="non-alcohol-related-injury"><p class="cbx-label">Injury and Illness</p></label></br>
            </div>

            <button type="button" id="check-all" class="map-btn first">All</button>
            <button type="button" id="clear-all" class="map-btn">None</button>
        </div>
    </div>
    <script src="http://maps.google.com/maps/api/js?key=AIzaSyD3ekwXld1OcEG3-Q09yA3kV6nZj3KNFUE&sensor=false"></script>
    <script src="http://bowdoinorient.com/js/heatmap.js"></script>
    <script src="http://bowdoinorient.com/js/heatmap-gmaps.js"></script>
    <script type="text/javascript">
        var alldata = [{"lat": 43.90737, "count": 1.0, "lng": -69.96236999999999, "type": "alcohol-related-transport"}, {"lat": 43.9088406, "count": 1.0, "lng": -69.96170579999999, "type": "alcohol-related-transport"}, {"lat": 43.9078645, "count": 2.0, "lng": -69.9621405, "type": "bike-theft"}, {"lat": 43.9038517, "count": 1.0, "lng": -69.9655619, "type": "bike-theft"}, {"lat": 43.907019, "count": 1.0, "lng": -69.9625348, "type": "bike-theft"}, {"lat": 43.905877, "count": 1.0, "lng": -69.96349339999999, "type": "bike-theft"}, {"lat": 43.9055633, "count": 1.0, "lng": -69.9623806, "type": "bike-theft"}, {"lat": 43.910011, "count": 1.0, "lng": -69.9640719, "type": "bike-theft"}, {"lat": 43.9082183, "count": 1.0, "lng": -69.9613609, "type": "bike-theft"}, {"lat": 43.9074111, "count": 2.0, "lng": -69.9615685, "type": "bike-theft"}, {"lat": 43.9065384, "count": 1.0, "lng": -69.9635741, "type": "bike-theft"}, {"lat": 43.90265, "count": 1.0, "lng": -69.9587648, "type": "bike-theft"}, {"lat": 43.910142, "count": 1.0, "lng": -69.95937889999999, "type": "car-related-incident"}, {"lat": 43.9050704, "count": 1.0, "lng": -69.9606223, "type": "car-related-incident"}, {"lat": 43.9140162, "count": 1.0, "lng": -69.9669961, "type": "car-related-incident"}, {"lat": 43.910011, "count": 1.0, "lng": -69.9640719, "type": "car-related-incident"}, {"lat": 43.9077582, "count": 1.0, "lng": -69.9655015, "type": "car-related-incident"}, {"lat": 43.9065384, "count": 1.0, "lng": -69.9635741, "type": "car-related-incident"}, {"lat": 43.9040705, "count": 1.0, "lng": -70.0370095, "type": "car-related-incident"}, {"lat": 43.9109133, "count": 1.0, "lng": -69.9569942, "type": "disruptive-individual"}, {"lat": 43.9140162, "count": 1.0, "lng": -69.9669961, "type": "disruptive-individual"}, {"lat": 43.9050704, "count": 1.0, "lng": -69.9606223, "type": "disruptive-individual"}, {"lat": 43.9071625, "count": 2.0, "lng": -69.96405779999999, "type": "disruptive-individual"}, {"lat": 43.9088726, "count": 1.0, "lng": -69.9648223, "type": "disruptive-individual"}, {"lat": 43.9140162, "count": 1.0, "lng": -69.9669961, "type": "disruptive-individual"}, {"lat": 43.9062277, "count": 1.0, "lng": -69.96186879999999, "type": "disruptive-individual"}, {"lat": 43.9074084, "count": 2.0, "lng": -69.9633247, "type": "disruptive-individual"}, {"lat": 43.9140162, "count": 1.0, "lng": -69.9669961, "type": "disruptive-individual"}, {"lat": 43.907246, "count": 1.0, "lng": -69.95971399999999, "type": "fire-alarm"}, {"lat": 43.9083433, "count": 1.0, "lng": -69.9619038, "type": "fire-alarm"}, {"lat": 43.9038517, "count": 2.0, "lng": -69.9655619, "type": "fire-alarm"}, {"lat": 43.9054826, "count": 1.0, "lng": -69.96437159999999, "type": "fire-alarm"}, {"lat": 43.905877, "count": 4.0, "lng": -69.96349339999999, "type": "fire-alarm"}, {"lat": 43.9107658, "count": 1.0, "lng": -69.96679499999999, "type": "fire-alarm"}, {"lat": 43.9073244, "count": 1.0, "lng": -69.96105279999999, "type": "fire-alarm"}, {"lat": 43.9074111, "count": 1.0, "lng": -69.9615685, "type": "fire-alarm"}, {"lat": 43.9077582, "count": 1.0, "lng": -69.9655015, "type": "fire-alarm"}, {"lat": 43.9056383, "count": 3.0, "lng": -69.9617422, "type": "fire-alarm"}, {"lat": 43.9093524, "count": 2.0, "lng": -69.9614565, "type": "fire-alarm"}, {"lat": 43.9078645, "count": 1.0, "lng": -69.9621405, "type": "hard-alcohol-violation"}, {"lat": 43.905877, "count": 2.0, "lng": -69.96349339999999, "type": "hard-alcohol-violation"}, {"lat": 43.9120637, "count": 1.0, "lng": -69.9661277, "type": "hard-alcohol-violation"}, {"lat": 43.9088726, "count": 1.0, "lng": -69.9648223, "type": "hard-alcohol-violation"}, {"lat": 43.90737, "count": 1.0, "lng": -69.96236999999999, "type": "hard-alcohol-violation"}, {"lat": 43.9062277, "count": 4.0, "lng": -69.96186879999999, "type": "hard-alcohol-violation"}, {"lat": 43.908081, "count": 2.0, "lng": -69.9653464, "type": "hard-alcohol-violation"}, {"lat": 43.9140162, "count": 2.0, "lng": -69.9669961, "type": "hard-alcohol-violation"}, {"lat": 43.9058761, "count": 1.0, "lng": -69.9624743, "type": "hard-alcohol-violation"}, {"lat": 43.9093524, "count": 1.0, "lng": -69.9614565, "type": "hard-alcohol-violation"}, {"lat": 43.9095715, "count": 1.0, "lng": -69.9645, "type": "marijuana"}, {"lat": 43.905877, "count": 2.0, "lng": -69.96349339999999, "type": "marijuana"}, {"lat": 43.901679, "count": 1.0, "lng": -69.9536486, "type": "minor-possession-of-alcohol"}, {"lat": 43.9088389, "count": 1.0, "lng": -69.9639433, "type": "minor-possession-of-alcohol"}, {"lat": 43.912861, "count": 1.0, "lng": -69.9680492, "type": "minor-possession-of-alcohol"}, {"lat": 43.91106449999999, "count": 3.0, "lng": -69.9614149, "type": "noise-complaint"}, {"lat": 43.9038517, "count": 5.0, "lng": -69.9655619, "type": "noise-complaint"}, {"lat": 43.9095715, "count": 1.0, "lng": -69.9645, "type": "noise-complaint"}, {"lat": 43.9029333, "count": 3.0, "lng": -69.9567198, "type": "noise-complaint"}, {"lat": 43.9055633, "count": 1.0, "lng": -69.9623806, "type": "noise-complaint"}, {"lat": 43.9074839, "count": 1.0, "lng": -69.9586255, "type": "noise-complaint"}, {"lat": 43.9140162, "count": 1.0, "lng": -69.9669961, "type": "noise-complaint"}, {"lat": 43.9110917, "count": 1.0, "lng": -69.96123, "type": "noise-complaint"}, {"lat": 43.9078645, "count": 3.0, "lng": -69.9621405, "type": "non-alcohol-related-injury"}, {"lat": 43.9081974, "count": 1.0, "lng": -69.9637745, "type": "non-alcohol-related-injury"}, {"lat": 43.9038517, "count": 2.0, "lng": -69.9655619, "type": "non-alcohol-related-injury"}, {"lat": 43.9054826, "count": 2.0, "lng": -69.96437159999999, "type": "non-alcohol-related-injury"}, {"lat": 43.907019, "count": 2.0, "lng": -69.9625348, "type": "non-alcohol-related-injury"}, {"lat": 43.9027859, "count": 1.0, "lng": -69.9598914, "type": "non-alcohol-related-injury"}, {"lat": 43.9029333, "count": 1.0, "lng": -69.9567198, "type": "non-alcohol-related-injury"}, {"lat": 43.9092627, "count": 1.0, "lng": -69.960566, "type": "non-alcohol-related-injury"}, {"lat": 43.90737, "count": 1.0, "lng": -69.96236999999999, "type": "non-alcohol-related-injury"}, {"lat": 43.9062277, "count": 1.0, "lng": -69.96186879999999, "type": "non-alcohol-related-injury"}, {"lat": 43.9140162, "count": 1.0, "lng": -69.9669961, "type": "non-alcohol-related-injury"}, {"lat": 43.9088406, "count": 1.0, "lng": -69.96170579999999, "type": "non-alcohol-related-injury"}, {"lat": 43.9073244, "count": 1.0, "lng": -69.96105279999999, "type": "non-alcohol-related-injury"}, {"lat": 43.9086708, "count": 1.0, "lng": -69.9601658, "type": "non-alcohol-related-injury"}, {"lat": 43.9021838, "count": 4.0, "lng": -69.95985660000001, "type": "non-alcohol-related-injury"}, {"lat": 43.9061688, "count": 1.0, "lng": -69.96722489999999, "type": "non-alcohol-related-injury"}, {"lat": 43.9095188, "count": 1.0, "lng": -69.9631966, "type": "non-alcohol-related-injury"}, {"lat": 43.9140162, "count": 1.0, "lng": -69.9669961, "type": "non-alcohol-related-injury"}, {"lat": 43.9055815, "count": 1.0, "lng": -69.9634944, "type": "non-alcohol-related-injury"}, {"lat": 43.9140162, "count": 1.0, "lng": -69.9669961, "type": "non-alcohol-related-injury"}, {"lat": 43.9093524, "count": 1.0, "lng": -69.9614565, "type": "non-alcohol-related-injury"}, {"lat": 43.908081, "count": 4.0, "lng": -69.9653464, "type": "public-indecency"}, {"lat": 43.9054008, "count": 1.0, "lng": -69.9621074, "type": "public-indecency"}, {"lat": 43.905877, "count": 1.0, "lng": -69.96349339999999, "type": "smoking-policy-violation"}, {"lat": 43.90737, "count": 1.0, "lng": -69.96236999999999, "type": "smoking-policy-violation"}, {"lat": 43.9140162, "count": 1.0, "lng": -69.9669961, "type": "theft"}, {"lat": 43.905877, "count": 1.0, "lng": -69.96349339999999, "type": "theft"}, {"lat": 43.9029333, "count": 1.0, "lng": -69.9567198, "type": "theft"}, {"lat": 43.9071625, "count": 1.0, "lng": -69.96405779999999, "type": "theft"}, {"lat": 43.9088726, "count": 1.0, "lng": -69.9648223, "type": "theft"}, {"lat": 43.9140162, "count": 1.0, "lng": -69.9669961, "type": "theft"}, {"lat": 43.9055191, "count": 1.0, "lng": -69.9689333, "type": "theft"}, {"lat": 43.9055815, "count": 1.0, "lng": -69.9634944, "type": "theft"}, {"lat": 43.9140162, "count": 1.0, "lng": -69.9669961, "type": "theft"}, {"lat": 43.9038517, "count": 1.0, "lng": -69.9655619, "type": "trespassing"}, {"lat": 43.905877, "count": 1.0, "lng": -69.96349339999999, "type": "trespassing"}, {"lat": 43.9107111, "count": 2.0, "lng": -69.95929360000001, "type": "trespassing"}, {"lat": 43.909825, "count": 1.0, "lng": -69.9598063, "type": "trespassing"}, {"lat": 43.9086708, "count": 1.0, "lng": -69.9601658, "type": "trespassing"}, {"lat": 43.9061688, "count": 2.0, "lng": -69.96722489999999, "type": "trespassing"}, {"lat": 43.9105436, "count": 1.0, "lng": -69.960544, "type": "trespassing"}, {"lat": 43.9064138, "count": 1.0, "lng": -69.9624843, "type": "unregistered-event"}, {"lat": 43.905877, "count": 1.0, "lng": -69.96349339999999, "type": "unregistered-event"}, {"lat": 43.9029333, "count": 3.0, "lng": -69.9567198, "type": "unregistered-event"}, {"lat": 43.9058761, "count": 2.0, "lng": -69.9624743, "type": "unregistered-event"}, {"lat": 43.9042, "count": 1.0, "lng": -69.959906, "type": "vandalism"}, {"lat": 43.910142, "count": 1.0, "lng": -69.95937889999999, "type": "vandalism"}, {"lat": 43.9038517, "count": 4.0, "lng": -69.9655619, "type": "vandalism"}, {"lat": 43.90475, "count": 1.0, "lng": -69.9605129, "type": "vandalism"}, {"lat": 43.9140162, "count": 1.0, "lng": -69.9669961, "type": "vandalism"}, {"lat": 43.9081041, "count": 1.0, "lng": -69.9628043, "type": "vandalism"}, {"lat": 43.9021838, "count": 1.0, "lng": -69.95985660000001, "type": "vandalism"}, {"lat": 43.9064138, "count": 3.0, "lng": -69.9624843, "type": "wall-damage"}, {"lat": 43.9088726, "count": 4.0, "lng": -69.9648223, "type": "wall-damage"}, {"lat": 43.9062277, "count": 1.0, "lng": -69.96186879999999, "type": "wall-damage"}, {"lat": 43.9088406, "count": 1.0, "lng": -69.96170579999999, "type": "wall-damage"}, {"lat": 43.9055815, "count": 1.0, "lng": -69.9634944, "type": "wall-damage"}, {"lat": 43.91106449999999, "count": 2.0, "lng": -69.9614149, "type": "wellness-check"}, {"lat": 43.9078645, "count": 2.0, "lng": -69.9621405, "type": "wellness-check"}, {"lat": 43.9064138, "count": 1.0, "lng": -69.9624843, "type": "wellness-check"}, {"lat": 43.9038517, "count": 3.0, "lng": -69.9655619, "type": "wellness-check"}, {"lat": 43.905877, "count": 2.0, "lng": -69.96349339999999, "type": "wellness-check"}, {"lat": 43.9029333, "count": 1.0, "lng": -69.9567198, "type": "wellness-check"}, {"lat": 43.90737, "count": 1.0, "lng": -69.96236999999999, "type": "wellness-check"}, {"lat": 43.9062277, "count": 1.0, "lng": -69.96186879999999, "type": "wellness-check"}, {"lat": 43.908081, "count": 2.0, "lng": -69.9653464, "type": "wellness-check"}, {"lat": 43.9073244, "count": 1.0, "lng": -69.96105279999999, "type": "wellness-check"}, {"lat": 43.9057504, "count": 1.0, "lng": -69.9612057, "type": "wellness-check"}, {"lat": 43.9140162, "count": 2.0, "lng": -69.9669961, "type": "wellness-check"}, {"lat": 43.9083507, "count": 1.0, "lng": -69.9608347, "type": "wellness-check"}, {"lat": 43.9058761, "count": 1.0, "lng": -69.9624743, "type": "wellness-check"}, {"lat": 43.9055815, "count": 2.0, "lng": -69.9634944, "type": "wellness-check"}];
        var selectdata = alldata;
        var heatmap;

        $("input:checkbox").each(function(){
            $(this).prop('checked', true);
        });

        $("input:checkbox.group").bind('change', function(){
            uncheck = !$(this).is(':checked');
            $("input:checkbox:not(.group)", $(this).parent().parent()).each(function(){
                if (uncheck) {
                    $(this).prop('checked', false);
                    $(this).change();
                } else {
                    $(this).prop('checked', true);
                    $(this).change();
                }
            });
        });

        $("input:checkbox:not(.group)").bind('change', function(){
            type_to_change = $(this).attr("id");

            if (!$(this).is(':checked')){
                $("input:checkbox.group", $(this).parent().parent()).prop('checked', false);
                selectdata = selectdata.filter(function(i){return i.type != type_to_change});
            }
            else {
                selectdata = selectdata.concat(alldata.filter(function(i){return i.type == type_to_change}));
            }

            update();
        });

        window.onload = function(){
            // standard gmaps initialization
            var myLatlng = new google.maps.LatLng(43.9068, -69.961385);
            // define map properties
            var myOptions = {
                zoom: 16,
                center: myLatlng,
                mapTypeId: google.maps.MapTypeId.HYBRID,
                disableDefaultUI: false,
                scrollwheel: true,
                draggable: true,
                navigationControl: true,
                mapTypeControl: false,
                scaleControl: true,
                disableDoubleClickZoom: false
            };
            var map = new google.maps.Map($(".heatmap-anchor")[0], myOptions);

            heatmap = new HeatmapOverlay(map, {
                "radius":30,
                "visible":true, 
                "opacity":60
            });

            var dataset = {
                max: 1.75,
                data: selectdata
            };

            // now we can set the data
            google.maps.event.addListenerOnce(map, "idle", function(){
                // this is important, because if you set the data set too early, the latlng/pixel projection doesn't work
                heatmap.setDataSet(dataset);
            });

        };

        $("#check-all").click(function(){
            $("input:checkbox").each(function(){
                $(this).prop('checked', true);
            });
            selectdata = alldata;
            update();
        });

        $("#clear-all").click(function(){
            $("input:checkbox").each(function(){
                $(this).prop('checked', false);
            });
            selectdata = [];
            update();
        });


        update = function() {
            dataset = {max:1.75, data:selectdata};
            heatmap.setDataSet(dataset);
        };
    </script>
</body>
</html>